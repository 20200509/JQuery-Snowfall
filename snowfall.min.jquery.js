(function(a){a.snowfall=function(d,b){function x(e,c,g,h,k){this.id=k;this.x=e;this.y=c;this.size=g;this.speed=h;this.step=0;this.stepSize=f(1,10)/100;b.collection&&(this.target=r[f(0,r.length-1)]);e=null;b.image?(e=a(document.createElement("img")),e[0].src=b.image):(e=a(document.createElement("div")),e.css({background:b.flakeColor}));e.attr({"class":"snowfall-flakes",id:"flake-"+this.id}).css({width:this.size,height:this.size,position:"absolute",top:this.y,left:this.x,fontSize:0,zIndex:b.flakeIndex});
a(d).get(0).tagName===a(document).get(0).tagName?(a("body").append(e),d=a("body")):a(d).append(e);this.element=document.getElementById("flake-"+this.id);this.update=function(){this.y+=this.speed;this.y>p-(this.size+6)&&this.reset();this.element.style.top=this.y+"px";this.element.style.left=this.x+"px";this.step+=this.stepSize;this.x=!1===s?this.x+Math.cos(this.step):this.x+(s+Math.cos(this.step));if(b.collection&&this.x>this.target.x&&this.x<this.target.width+this.target.x&&this.y>this.target.y&&
this.y<this.target.height+this.target.y){var a=this.target.element.getContext("2d"),d=this.x-this.target.x,c=this.y-this.target.y,e=this.target.colData;if(void 0!==e[parseInt(d)][parseInt(c+this.speed+this.size)]||c+this.speed+this.size>this.target.height)if(c+this.speed+this.size>this.target.height){for(;c+this.speed+this.size>this.target.height&&0<this.speed;)this.speed*=0.5;a.fillStyle="#fff";void 0==e[parseInt(d)][parseInt(c+this.speed+this.size)]?(e[parseInt(d)][parseInt(c+this.speed+this.size)]=
1,a.fillRect(d,c+this.speed+this.size,this.size,this.size)):(e[parseInt(d)][parseInt(c+this.speed)]=1,a.fillRect(d,c+this.speed,this.size,this.size));this.reset()}else this.speed=1,this.stepSize=0,parseInt(d)+1<this.target.width&&void 0==e[parseInt(d)+1][parseInt(c)+1]?this.x++:0<parseInt(d)-1&&void 0==e[parseInt(d)-1][parseInt(c)+1]?this.x--:(a.fillStyle="#fff",a.fillRect(d,c,this.size,this.size),e[parseInt(d)][parseInt(c)]=1,this.reset())}(this.x>q-l||this.x<l)&&this.reset()};this.reset=function(){this.y=
0;this.x=f(l,q-l);this.stepSize=f(1,10)/100;this.size=f(100*b.minSize,100*b.maxSize)/100;this.speed=f(b.minSpeed,b.maxSpeed)}}function u(){for(c=0;c<m.length;c+=1)m[c].update();v=setTimeout(function(){u()},30)}b=a.extend({flakeCount:35,flakeColor:"#ffffff",flakeIndex:999999,minSize:1,maxSize:2,minSpeed:1,maxSpeed:5,round:!1,shadow:!1,collection:!1,collectionHeight:40,deviceorientation:!1},b);var f=function(a,b){return Math.round(a+Math.random()*(b-a))};a(d).data("snowfall",this);var m=[],g=0,c=0,
p=a(d).height(),q=a(d).width(),l=0,v=0;if(!1!==b.collection)if(g=document.createElement("canvas"),g.getContext&&g.getContext("2d"))for(var r=[],g=a(b.collection),n=b.collectionHeight,c=0;c<g.length;c++){var h=g[c].getBoundingClientRect(),k=document.createElement("canvas"),w=[];if(0<h.top-n){document.body.appendChild(k);k.style.position="absolute";k.height=n;k.width=h.width;k.style.left=h.left+"px";k.style.top=h.top-n+"px";for(var t=0;t<h.width;t++)w[t]=[];r.push({element:k,x:h.left,y:h.top-n,width:h.width,
height:n,colData:w})}}else b.collection=!1;a(d).get(0).tagName===a(document).get(0).tagName&&(l=25);a(window).bind("resize",function(){p=a(d)[0].clientHeight;q=a(d)[0].offsetWidth;console.log(p)});for(c=0;c<b.flakeCount;c+=1)g=m.length,m.push(new x(f(l,q-l),f(0,p),f(100*b.minSize,100*b.maxSize)/100,f(b.minSpeed,b.maxSpeed),g));b.round&&a(".snowfall-flakes").css({"-moz-border-radius":b.maxSize,"-webkit-border-radius":b.maxSize,"border-radius":b.maxSize});b.shadow&&a(".snowfall-flakes").css({"-moz-box-shadow":"1px 1px 1px #555",
"-webkit-box-shadow":"1px 1px 1px #555","box-shadow":"1px 1px 1px #555"});var s=!1;b.deviceorientation&&a(window).bind("deviceorientation",function(a){s=0.1*a.originalEvent.gamma});u();this.clear=function(){a(d).children(".snowfall-flakes").remove();m=[];clearTimeout(v)}};a.fn.snowfall=function(d){if("object"==typeof d||void 0==d)return this.each(function(b){new a.snowfall(this,d)});if("string"==typeof d)return this.each(function(b){(b=a(this).data("snowfall"))&&b.clear()})}})(jQuery);